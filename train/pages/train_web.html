<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="/styles/common.css">
    <link rel="stylesheet" href="/styles/train_query.css">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">

    <title>车次查询</title>
    <style media="screen">
        body {
            min-width: 1200px;
            background: #fff;
        }

        .el-input {
            width: auto;
        }

        .transition-box {
            margin-bottom: 10px;
            border-radius: 4px;
            background-color: #fff;
            color: #fff;
            padding: 8px 10px;
            color: #000;
            box-sizing: border-box;
        }

        .el-checkbox-group {
            display: inline-block;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div id="train_query">
            <div id="train_search_box" class="clearfix">
                <div class="search_conditions">
                    <span class="input_title">出发站：</span>
                    <el-autocomplete v-model="state4" :fetch-suggestions="querySearchAsyncDep" placeholder="请输入内容" @select="handleSelectDep"></el-autocomplete>
                </div>
                <div class="search_conditions">
                    <span class="station_change"></span>
                </div>
                <div class="search_conditions">
                    <span class="input_title">到达站：</span>
                    <el-autocomplete v-model="state5" :fetch-suggestions="querySearchAsyncArr" placeholder="请输入内容" @select="handleSelectArr"></el-autocomplete>
                </div>
                <div class="search_conditions">
                    <span class="input_title">出发日期：</span>
                    <el-date-picker v-model="value1" type="date" placeholder="选择日期" :picker-options="pickerOptions0" value-format="yyyy-MM-dd">
                    </el-date-picker>
                </div>
                <div class="search_conditions">
                    <el-button type="primary" @click="trainQuery">查询</el-button>
                </div>
            </div>
            <div class="train_run">
                <div id="back">
                </div>
                <div id="all">
                    <div class="tranHand">
                        <div class="windows"></div>
                        <div class="door">
                            <div class="windows"></div>
                        </div>
                        <div class="yellow"></div>
                    </div>
                    <div class="tranBody">
                        <div class="windows"></div>
                        <div class="door">
                            <div class="windows"></div>
                        </div>
                        <div class="windows2"></div>
                        <div class="yellow"></div>
                    </div>
                    <div class="tranBody">
                        <div class="windows"></div>
                        <div class="door">
                            <div class="windows"></div>
                        </div>
                        <div class="windows2"></div>
                        <div class="yellow"></div>
                    </div>
                    <div class="tranBody">
                        <div class="windows"></div>
                        <div class="door">
                            <div class="windows"></div>
                        </div>
                        <div class="windows2"></div>
                        <div class="yellow"></div>
                    </div>
                    <div class="tranLast">
                        <div class="windows"></div>
                        <div class="door">
                            <div class="windows"></div>
                        </div>
                        <div class="yellow"></div>
                    </div>
                </div>
            </div>
            <div id="train_info" class="clearfix">
                <section class="train_info_left">
                    <section id="date_pick">

                    </section>
                    <section class="train_screen">
                        <el-button @click="show3 = !show3" style="position:absolute;bottom:20px;right:10px;">更多条件</el-button>
                        <div class="transition-box clearfix">
                            <span>车&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;型：</span>
                            <el-checkbox :indeterminate="isIndeterminate" v-model="checkTypeAll" @change="handleCheckTypeAllChange" :disabled="typeOk">不限</el-checkbox>
                            <el-checkbox-group v-model="checkedType" @change="handleCheckedTypeChange">
                                <el-checkbox v-for="type in trainType" :label="type.code" :key="type.code">{{type.name}}</el-checkbox>
                            </el-checkbox-group>
                        </div>
                        <div>
                            <el-collapse-transition>
                                <div v-show="show3">
                                    <div class="transition-box clearfix">
                                        <span>出发时段：</span>
                                        <el-checkbox :indeterminate="isIndeterminate" v-model="checkDepTimeAll" @change="handleCheckDepTimeAllChange" :disabled="depTimeOk">不限</el-checkbox>
                                        <el-checkbox-group v-model="checkDepTime" @change="handleCheckedDepTimeChange">
                                            <el-checkbox v-for="time in depTime" :label="time" :key="time">{{time}}</el-checkbox>
                                        </el-checkbox-group>
                                    </div>
                                    <div class="transition-box clearfix">
                                        <span>到达时段：</span>
                                        <el-checkbox :indeterminate="isIndeterminate" v-model="checkArrTimeAll" @change="handleCheckArrTimeAllChange" :disabled="arrTimeOk">不限</el-checkbox>
                                        <el-checkbox-group v-model="checkArrTime" @change="handleCheckedArrTimeChange">
                                            <el-checkbox v-for="time in arrTime" :label="time" :key="time">{{time}}</el-checkbox>
                                        </el-checkbox-group>
                                    </div>
                                    <div class="transition-box clearfix">
                                        <span>出发车站：</span>
                                        <el-checkbox :indeterminate="isIndeterminate" v-model="checkDepStationAll" @change="handleCheckDepStationAllChange" :disabled="depStationOk">不限</el-checkbox>
                                        <el-checkbox-group v-model="checkDepStation" @change="handleCheckedDepStationChange">
                                            <el-checkbox v-for="station in depStation" :label="station.stationCode" :key="station.stationName">{{station.stationName}}</el-checkbox>
                                        </el-checkbox-group>
                                    </div>
                                    <div class="transition-box clearfix">
                                        <span>到达车站：</span>
                                        <el-checkbox :indeterminate="isIndeterminate" v-model="checkArrStationAll" @change="handleCheckArrStationAllChange" :disabled="arrStationOk">不限</el-checkbox>
                                        <el-checkbox-group v-model="checkArrStation" @change="handleCheckedArrStationChange">
                                            <el-checkbox v-for="station in arrStation" :label="station.stationCode" :key="station.stationName">{{station.stationName}}</el-checkbox>
                                        </el-checkbox-group>
                                    </div>
                                    <div class="transition-box clearfix">
                                        <span>始发过路：</span>
                                        <el-checkbox :indeterminate="isIndeterminate" v-model="checkFromPassingAll" @change="handleCheckFromPassingAllChange" :disabled="fromPassingOk">不限</el-checkbox>
                                        <el-checkbox-group v-model="checkFromPassing" @change="handleCheckedFromPassingChange">
                                            <el-checkbox v-for="station in fromPassing" :label=station.index :key=station.index >{{station.fp}}</el-checkbox>
                                        </el-checkbox-group>
                                    </div>
                                </div>
                            </el-collapse-transition>
                        </div>
                    </section>
                    <section id="train_lists">
                        <div class="train_lists_title clearfix">
                            <span>车次</span>
                            <span>时间</span>
                            <span>车站</span>
                            <span>运行时长</span>
                            <span>参考价</span>
                            <span> </span>
                        </div>
                        <ul>
                            <li class="clearfix" v-for="list in lists" :train_no="list.trainInfo.trainNo">
                                <div>
                                    <p class="train_code">{{list.trainInfo.trainCode}}</p>
                                    <p>
                                        <el-button size="mini" @click="passStation(1)">经停站</el-button>
                                    </p>
                                </div>
                                <div class="station_time">
                                    <p v-if=list.fromStationType===1>
                                        <span class="train_dep_time">{{list.trainInfo.startTime}}</span>
                                    </p>
                                    <p v-else>
                                        <span class="train_pass_time">{{list.trainInfo.startTime}}</span>
                                    </p>
                                    <p>
                                        <span class="train_arr_time">{{list.trainInfo.arriveTime}}
                                            <a href="javascript:;" style="color:skyblue" v-if=list.trainInfo.arriveDays!=0>+{{list.trainInfo.arriveDays}}</a>
                                        </span>
                                    </p>
                                </div>
                                <div>
                                    <p :code="list.trainInfo.fromStationCode">{{list.trainInfo.fromStationName}}</p>
                                    <p :code="list.trainInfo.toStationCode">{{list.trainInfo.toStationName}}</p>
                                </div>
                                <div>
                                    <p> </p>
                                    <p>{{list.trainInfo.runTime}}</p>
                                </div>
                                <div>
                                    <p v-for="seat in list.trainInfo.TrainSeat">
                                        <span>{{seat.SeatName}}</span>
                                        <a href="javascript:;" style="color:#fa0;">￥{{seat.Price}}</a>
                                    </p>
                                    <!-- <p>
                                        <span>硬座</span>
                                        <a href="javascript:;" style="color:#fa0;">￥251</a>
                                    </p>
                                    <p>
                                        <span>硬座</span>
                                        <a href="javascript:;" style="color:#fa0;">￥251</a>
                                    </p> -->
                                </div>
                                <div class="ticket_book">
                                    <p v-for="seat in list.trainInfo.TrainSeat">
                                        <span>余
                                            <mark>{{seat.SeatNumber}}</mark> 张</span>
                                        <span v-if=seat.SeatNumber===0>
                                            <el-button size="mini" type="info" disabled :seat_code="seat.SeatCode">预订</el-button>
                                        </span>
                                        <span v-else>
                                            <el-button size="mini" type="warning" :seat_code="seat.SeatCode" @click="orderTicket">预订</el-button>
                                        </span>
                                    </p>
                                </div>
                                <section class="passStationInfo">
                                    <div v-loading="loading" element-loading-spinner="el-icon-loading" element-loading-background="rgba(0, 0, 0, 0.8)">
                                        <p class="passStation_title clearfix">
                                            <span>&nbsp;</span>
                                            <span>车站名</span>
                                            <span>到达时间</span>
                                            <span>发车时间</span>
                                            <span>停留时间</span>
                                        </p>
                                        <ul class="passStation">
                                            <li class="clearfix" v-for="item in passStations">
                                                <span>{{item.ID}}</span>
                                                <span>{{item.stationName}}</span>
                                                <span>{{item.arriveTime}}</span>
                                                <span>{{item.startTime}}</span>
                                                <span>{{item.stopTime}}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </section>
                            </li>
                        </ul>
                    </section>
                </section>
                <aside class="train_info_right">
                    <h3>火车票小助手提示</h3>
                    <ul>
                        <li class="clearfix">
                            <h5>线下取票</h5>
                            <p>火车站售票窗口、铁路客票代售点或车站自动售票机均可取票。取票需携带瘦小身份证件。</p>
                        </li>
                        <li class="clearfix">
                            <h5>退票说明</h5>
                            <p>未换取纸质车票，发车前3小时可以在线申请退票。已取票的乘客，如需退票，请凭购票有效证件在发车前到火车站退票窗口办理。</p>
                        </li>
                        <li class="clearfix">
                            <h5>退票费用</h5>
                            <p>无票或取消订单退款到帐时间约为 3 一 21 天，按银行规定时限原渠道返还。开车时间巧夭（不含）以上退票的，不收退票费；15天（含）以内 48 小时以上的按票价 5 ％计； 24 小时以上、不足
                                48 小时的按票价 10 ％计；不足 24 小时的按票价 20 ％计。并按照最低 2 元/张收取退票费。如果改签后乘车日期在春运期间收取 20 ％的退票费。最终退款以铁路局实退为准。</p>
                        </li>
                        <li class="clearfix">
                            <h5>车票改签</h5>
                            <p>暂不提供改签服务，需携带购票有效证件原件和火车票，在火车发车前，前去始发地火车站窗口，按照铁路局相关规定办理。</p>
                        </li>
                    </ul>
                </aside>
            </div>

        </div>

    </div>
    <script type="text/javascript" th:src="|${_staticPath}/libs/jquery-1.11.2/jquery.min.js|"></script>
    <!-- 引入 Vue -->
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <!-- 引入组件库 -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <script type="text/javascript">
        var staticPath = "[[${_staticPath}]]",
            dynamicPath = "[[${_dynamicPath}]]",
            apiPath = "[[${_apiPath}]]" + "/train/v1",
            date = "[[${date}]]",
            fromCode = "[[${fromCode}]]",
            fromName = "[[${fromName}]]",
            toCode = "[[${toCode}]]",
            toName = "[[${toName}]]",
            bullet = "[[${bullet}]]";

        const trainTypeArr = [{
            'name': 'G 高铁 / D 动车 / C 城际',
            'code': '1'
        }, {
            'name': '快车（Z / T / K）',
            'code': '2'
        }, {
            'name': 'L临客 / 普快',
            'code': '3'
        }];
        const depTimeArr = ['00:00-06:00', '06:00-12:00', '12:00-18:00', '18:00-02:00'];
        const arrTimeArr = ['00:00-06:00', '06:00-12:00', '12:00-18:00', '18:00-02:00'];
        const depStationArr = ['北京西'];
        const arrStationArr = ['广州', '广州南', '广州东'];
        const fromPassingArr = [
        	{	'index':'1',
        		'fp': '始发'
        	},
        	{	
        		"index": '2',
        		'fp': '过路'
        	}
        ];
        var train_query = {
            data() {
                return {
                    // 
                    pickerOptions0: { //日期选择器
                        disabledDate(time) {
                            return time.getTime() < Date.now() - 8.64e7;
                        }
                    },
                    depCityCode: '',
                    depCityName: '',
                    arrCityCode: '',
                    arrCityName: '',
                    cityInfo: [],
                    citys: [],
                    state4: '',
                    state5: '',
                    timeout: null,
                    high_train: false,
                    // 
                    value1: '',
                    typeOk: false,
                    depTimeOk: false,
                    arrTimeOk: false,
                    depStationOk: false,
                    arrStationOk: false,
                    fromPassingOk: false,
                    checkTypeAll: true,
                    checkDepTimeAll: true,
                    checkArrTimeAll: true,
                    checkDepStationAll: true,
                    checkArrStationAll: true,
                    checkFromPassingAll: true,
                    checkedType: [],
                    checkDepTime: [],
                    checkArrTime: [],
                    checkDepStation: [],
                    checkArrStation: [],
                    checkFromPassing: [],
                    trainType: trainTypeArr,
                    depTime: depTimeArr,
                    arrTime: arrTimeArr,
                    depStation: '',
                    arrStation: '',
                    depStationCode: '',
                    arrStationCode: '',
                    fromPassing: fromPassingArr,
                    trainTypeNo: '',
                    passStations: '',
                    isIndeterminate: false,
                    nowDate: '2017-11-27',
                    dates: '',
                    // 
                    show3: false,
                    loading: true,
                    input1: '',
                    input2: '',
                    input3: '',
                    input4: '',
                    input5: '',
                    input6: '',
                    searchDate: '',
                    fromStation: '',
                    toStation: '',
                    lists: []
                }
            },
            created: function () {
                console.log(date)
                this.searchDate = location.href.substr(location.href.indexOf("2"), 10);
                this.fromStation = location.href.substr(location.href.indexOf("2") + 11, 3);
                this.toStation = location.href.split("/")[6].substr(0, 3);
                var that = this;
                $.ajax({
                    type: "post",
                    url: apiPath + "/list/train",
                    data: {
                        "date": date,
                        "from": fromCode,
                        "to": toCode
                    },
                    dataType: "JSON",
                    success: function (response) {
                        var _that = that;
                        var depStation = [];
                        var depStationCode = [];
                        var arrStation = [];
                        var arrStationCode = [];
                        _that.lists = response.data.trainInfos
                        for (let index = 0; index < response.data.departStations.length; index++) {
                            depStation.push({
                                'stationName': response.data.departStations[index].stationName,
                                'stationCode': response.data.departStations[index].stationCode
                            });
                        };
                        for (let index = 0; index < response.data.arriveStations.length; index++) {
                            arrStation.push({
                                'stationName': response.data.arriveStations[index].stationName,
                                'stationCode': response.data.arriveStations[index].stationCode
                            });
                        }

                        _that.depStation = depStation;
                        _that.arrStation = arrStation;
                        console.log(response)
                    }
                });

            },
            methods: {
                dateInfo(index) {
                    $('#date_pick li').eq(2).addClass('active')
                    // $(event.currentTarget).

                    $('#date_pick li').css({
                        "left": -$('#date_pick').width() / 7 * ((index + 1) % 4)
                    })
                    // let click_date = $(event.currentTarget).attr('allDate');
                    // let week = this.getMyDay(new Date(click_date));
                    // console.log(week)

                    // console.log($(event.currentTarget).text(),w1)
                },
                passStation(index) {
                    let trainCode = $(event.currentTarget).parent().prev().text();
                    let trainNo = $(event.currentTarget).parents('li').attr('train_no');
                    $('.passStationInfo').hide();
                    this.passStations = '';
                    this.loading = true;
                    let that = this;
                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/passStation",
                        data: {
                            "trainCode": trainCode,
                            "trainNo": trainNo,
                            "startTime": that.searchDate,
                            "fromCode": that.fromStation,
                            "toCode": that.toStation
                        },
                        dataType: "json",
                        success: function (response) {
                            that.passStations = response.data.passStations;
                            that.loading = false;
                        }
                    });

                    $(event.currentTarget).parents('li').children('section').toggle();
                },
                loadAll() {

                    return [

                    ];
                },
                querySearchAsyncDep(queryString, cb) {
                    this.citys = this.requireCity(queryString);
                    var citys = this.citys;
                    var results = queryString ? citys.filter(this.createStateFilterDep(queryString)) : citys;
                    clearTimeout(this.timeout);

                    this.timeout = setTimeout(() => {
                        cb(results);
                    }, 300 * Math.random());
                },
                createStateFilterDep(queryString) {
                    return (state) => {
                        return (state.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0 || state.code
                            .toLowerCase().indexOf(queryString.toLowerCase()) === 0 || state.name.toLowerCase()
                            .indexOf(queryString.toLowerCase()) === 0);
                    };
                },
                handleSelectDep(item) {
                    this.depCityCode = item.code;
                    this.depCityName = item.name;
                },
                querySearchAsyncArr(queryString, cb) {
                    this.citys = this.requireCity(queryString);
                    var citys = this.citys;
                    var results = queryString ? citys.filter(this.createStateFilterArr(queryString)) : citys;
                    clearTimeout(this.timeout);

                    this.timeout = setTimeout(() => {
                        cb(results);
                    }, 300 * Math.random());
                },
                createStateFilterArr(queryString) {

                    return (state) => {
                        return (state.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0 || state.code
                            .toLowerCase().indexOf(queryString.toLowerCase()) === 0 || state.name.toLowerCase()
                            .indexOf(queryString.toLowerCase()) === 0);
                    };
                },
                handleSelectArr(item) {
                    this.arrCityCode = item.code;
                    this.arrCityName = item.name;
                },
                city_change() {
                    let depCityCode = this.depCityCode;
                    let arrCityCode = this.arrCityCode;
                    let depCityName = this.depCityName;
                    let arrCityName = this.arrCityName;
                    let depCity = this.state4;
                    this.depCityCode = arrCityCode;
                    this.depCityName = arrCityName;
                    this.arrCityCode = depCityCode;
                    this.arrCityName = depCityName;
                    this.state4 = this.state5;
                    this.state5 = depCity;
                },
                //全部查询
                requireCity(str) {
                    var that = this;
                    $.ajax({
                        type: "post",
                        url: apiPath + "/index/dtCityFuzzyMatching",
                        data: {
                            "fuzzyWord": str
                        },
                        dataType: "json",
                        success: function (response) {
                            that.cityInfo = [];
                            let cityInfo = response.data;
                            for (let index = 0; index < cityInfo.length; index++) {
                                cityInfo[index].value = cityInfo[index].name;
                            }
                            that.cityInfo = cityInfo;
                        }
                    });
                    return this.cityInfo;
                },
                //车型筛选查询
                handleCheckTypeAllChange(val) {

                    this.checkedType = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkTypeAll) {
                        this.typeOk = true
                    }
                    this.checkedAll()
                },
                handleCheckedTypeChange(value) {
                    let trainTypeCode = '';
                    let trainTypes = [];
                    let datas = '{';
                    let datesObj = {};
                    for (let index = 0; index < value.length; index++) {
                        trainTypes.push(value[index]);
                        trainTypeCode += `'trainTypes[${index}]':'${trainTypes[index]}',`;
                    }
                    datas += trainTypeCode;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    let checkedCount = value.length;
                    this.checkTypeAll = false;
                    if (checkedCount == 0) {
                        this.checkTypeAll = true;
                        this.typeOk = true
                    } else {
                        this.typeOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;

                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //出发时间筛选查询
                handleCheckDepTimeAllChange(val) {

                    this.checkDepTime = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkDepTimeAll) {
                        this.depTimeOk = true
                    }
                    this.checkedAll()

                },
                handleCheckedDepTimeChange(value) {

                    var startTimes = '';
                    var startTimeArr = [];
                    for (let index = 0; index < value.length; index++) {
                        const startTime = value[index].split("-")[0];
                        const endTime = value[index].split("-")[1];
                        startTimeArr.push({
                            "startTime": startTime,
                            "arriveTime": endTime
                        })
                    }
                    let datas = '{';
                    let datesObj = {};

                    for (let index = 0; index < startTimeArr.length; index++) {
                        // startTimeArr.push(value[index]);
                        startTimes += `'startTimes[${index}].startTime':'${startTimeArr[index].startTime}',`;
                        startTimes += `'startTimes[${index}].arriveTime':'${startTimeArr[index].arriveTime}',`;
                    }
                    datas += startTimes;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    let depTime = '';
                    let checkedCount = value.length;
                    this.checkDepTimeAll = false
                    if (checkedCount == 0) {
                        this.checkDepTimeAll = true;
                        this.depTimeOk = true
                    } else {
                        this.depTimeOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;

                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //到达时间筛选查询
                handleCheckArrTimeAllChange(val) {
                    this.checkArrTime = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkArrTimeAll) {
                        this.arrTimeOk = true
                    }
                    this.checkedAll()
                },
                handleCheckedArrTimeChange(value) {
                    var  arriveTimes = '';
                    var arriveTimeArr = [];
                    for (let index = 0; index < value.length; index++) {
                        const startTime = value[index].split("-")[0];
                        const endTime = value[index].split("-")[1];
                        arriveTimeArr.push({
                            "startTime": startTime,
                            "arriveTime": endTime
                        })
                    }
                    let datas = '{';
                    let datesObj = {};

                    for (let index = 0; index < arriveTimeArr.length; index++) {
                        arriveTimes += `'arriveTimes[${index}].startTime':'${arriveTimeArr[index].startTime}',`;
                        arriveTimes += `'arriveTimes[${index}].arriveTime':'${arriveTimeArr[index].arriveTime}',`;
                    }
                    datas += arriveTimes;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    let checkedCount = value.length;
                    this.checkArrTimeAll = false
                    if (checkedCount == 0) {
                        this.checkArrTimeAll = true;
                        this.arrTimeOk = true
                    } else {
                        this.arrTimeOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;

                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //到达车站筛选查询
                handleCheckDepStationAllChange(val) {
                    this.checkDepStation = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkDepStationAll) {
                        this.depStationOk = true
                    }
                    this.checkedAll()
                },
                handleCheckedDepStationChange(value) {
                    let fromCodes = '';
                    let fromCodesArr = [];
                    let datas = '{';
                    let datesObj = {};
                    for (let index = 0; index < value.length; index++) {
                        fromCodesArr.push(value[index]);
                        fromCodes += `'fromCodes[${index}]':'${fromCodesArr[index]}',`;
                    }
                    datas += fromCodes;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    let checkedCount = value.length;
                    this.checkDepStationAll = false
                    if (checkedCount == 0) {
                        this.checkDepStationAll = true;
                        this.depStationOk = true
                    } else {
                        this.depStationOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;

                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //到达车站筛选查询
                handleCheckArrStationAllChange(val) {
                    this.checkArrStation = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkArrStationAll) {
                        this.arrStationOk = true
                    }
                    this.checkedAll()
                },
                handleCheckedArrStationChange(value) {
                    let arriveCodes = '';
                    let arriveCodesArr = [];
                    let datas = '{';
                    let datesObj = {};
                    for (let index = 0; index < value.length; index++) {
                        arriveCodesArr.push(value[index]);
                        arriveCodes += `'arriveCodes[${index}]':'${arriveCodesArr[index]}',`;
                    }
                    datas += arriveCodes;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    let checkedCount = value.length;
                    this.checkArrStationAll = false
                    if (checkedCount == 0) {
                        this.checkArrStationAll = true;
                        this.arrStationOk = true
                    } else {
                        this.arrStationOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;
                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //始发过路筛选查询
                handleCheckFromPassingAllChange(val) {
                    this.checkFromPassing = val ? [] : [];
                    this.isIndeterminate = false
                    if (this.checkFromPassingAll) {
                        this.fromPassingOk = true
                    }
					this.checkedAll()
                },
                handleCheckedFromPassingChange(value) {
                    let fromPassing = '';
                    let fromPassingArr = [];
                    let datas = '{';
                    let datesObj = {};
                    if (this.checkFromPassingAll) {
                        this.fromPassingOk = true
                    }
                    this.checkFromPassing = val ? [] : [];
                    // for (let index = 0; index < value.length; index++) {
                    //     fromPassingArr.push(value[index]);
                    //     fromPassing += `'fromPassingArr[${index}]':'${fromPassingArr[index]}',`;
                    // }
                    fromPassing = value[value.length-1];
                    datas += fromPassing;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');

                    let checkedCount = value.length;
                    this.checkFromPassingAll = false
                    if (checkedCount == 0) {
                        this.checkFromPassingAll = true;
                        this.fromPassingOk = true
                    } else {
                        this.fromPassingOk = false
                    }
                    this.isIndeterminate = false;
                    var that = this;

                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                trainQuery() {
                    window.location.href = dynamicPath + "/query.html/" + this.value1 + "/" + this.depCityCode +
                        "&" + this.depCityName + "/" + this.arrCityCode + "&" + this.arrCityName + "/0"
                },
                filter_search() {
                    var data = {};
                    data.FromCode = $("#" + 'ctl00_ContentPlaceHolder1_title_fromCode').val();
                    data.ToCode = $("#" + 'ctl00_ContentPlaceHolder1_title_toCode').val();
                    data.trainType = $("#Train_type .filter_option.on").attr("filter_val");
                    data.FilterStartTime = $("#from_time .filter_option.on").attr("filter_val");
                    data.FilterArriveTime = $("#to_time .filter_option.on").attr("filter_val");

                    data.Time = $("#DaysList li.on").attr("day_val");
                    // var url = "ajaxFile/TrainsHelper.ashx";
                    data.action = "TrainsList";
                    $("#" + 'ctl00_ContentPlaceHolder1_TrainsListBox').html("");
                    $("#hotel_list_login").show();

                    $.ajax(url, {
                        type: "post",
                        async: true,
                        data: data,
                        success: function (data) {
                            $("#" + 'ctl00_ContentPlaceHolder1_TrainsListBox').html(data);
                            $("#hotel_list_login").hide();
                            $(".con_datas .con_data").hover(function () {
                                $(this).addClass("on")
                                $(this).find(".fromtime").animate({
                                    "font-size": "30px"
                                }, 150);
                            }, function () {
                                $(this).removeClass("on")
                                $(this).find(".fromtime").animate({
                                    "font-size": "25px"
                                }, 150);
                            })
                        },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            $("#hotel_list_login").hide();
                        }
                    });
                },
                click_li() {
                    if (!$(this).hasClass("on")) {
                        $(this).addClass("on").siblings().removeClass("on");
                    }
                    var on_index = $("#DaysList li.on").index();
                    var from = (on_index - 3) <= 0 ? 0 : (on_index - 3);
                    from = from > 23 ? 23 : from;
                    $("#DaysList").animate({
                        "left": -((from * 100) - 50) + "px"
                    }, 200);
                    this.filter_search();
                },
                click_l() {
                    var left = parseInt($("#DaysList").css("left").replace("px", ""));
                    left = (left + 700) < 50 ? (left + 700) : 50;

                    $("#DaysList").animate({
                        "left": left + "px"
                    }, 200);
                },
                click_r() {
                    var left = parseInt($("#DaysList").css("left").replace("px", ""));
                    left = (left - 700) > -2250 ? (left - 700) : -2250;
                    console.log(left);
                    $("#DaysList").animate({
                        "left": left + "px"
                    }, 200);
                },
                train_filter(cond) {
                    console.log(cond)
                },
                checkedAll() {
                    let datas = '{';
                    let datesObj = {};
                    let that = this;
                    datas += `'date':'${date}',`;
                    datas += `'from':'${fromCode}',`;
                    datas += `'to':'${toCode}',`;
                    datas += "}"
                    datasObj = eval('(' + datas + ')');
                    $.ajax({
                        type: "post",
                        url: apiPath + "/list/train",
                        data: datasObj,
                        dataType: "JSON",
                        success: function (response) {

                            var _that = that;
                            _that.lists = response.data.trainInfos

                        }
                    });
                },
                //预订车票
                orderTicket(){
                    let seatCode = $(event.currentTarget).attr('seat_code');
                    let trainNo = $(event.currentTarget).parents('li').attr('train_no');
                    console.log(seatCode,trainNo)
                }
            },
            mounted() {
                this.citys = this.loadAll();
            }
        }
        var Ctor = Vue.extend(train_query)
        new Ctor().$mount('#train_query')
    </script>
</body>

</html>